<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Grade 6 Math Proficiency Test</title>
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#4db6ac">
    <style>
        :root { --primary: #4db6ac; --secondary: #ff5722; --bg: #f4f7f6; }
        body { font-family: 'Segoe UI', Tahoma, sans-serif; background-color: var(--bg); margin: 0; padding: 10px; }
        .container { max-width: 800px; margin: 0 auto; background: white; padding: 25px; border-radius: 20px; box-shadow: 0 10px 30px rgba(0,0,0,0.1); position: relative; min-height: 450px; text-align: center; }
        .hidden { display: none; }
        .owl-img { width: 120px; height: auto; display: block; margin: 0 auto 15px; }
        .bubble { background: #fff; border: 3px solid var(--primary); padding: 15px; border-radius: 15px; font-weight: bold; color: #00796b; margin-bottom: 20px; position: relative; }
        .header-info { display: flex; justify-content: space-between; align-items: center; background: #e0f2f1; padding: 15px; border-radius: 10px; border: 2px solid var(--primary); margin-bottom: 20px; }
        #timer { font-size: 24px; font-weight: bold; color: #d32f2f; }
        .option { display: block; background: #fff; border: 2px solid #b2dfdb; padding: 12px; margin: 8px 0; border-radius: 10px; cursor: pointer; text-align: left; transition: 0.3s; }
        .option.selected { background: var(--primary); color: white; border-color: #00796b; }
        .q-img { max-width: 100%; height: auto; border-radius: 10px; margin: 10px 0; border: 1px solid #ddd; }
        button { padding: 15px 30px; border: none; border-radius: 50px; cursor: pointer; font-weight: bold; font-size: 16px; transition: 0.3s; }
        .btn-start { background: var(--secondary); color: white; width: 100%; font-size: 20px; }
        .btn-next { background: var(--primary); color: white; }
        .admin-btn { position: absolute; top: 10px; right: 10px; opacity: 0.3; font-size: 10px; cursor: pointer; }
        .review-box { border: 1px solid #ddd; padding: 10px; margin: 5px 0; border-radius: 8px; text-align: left; font-size: 14px; }
        .correct { color: #2ecc71; font-weight: bold; }
        .wrong { color: #e74c3c; font-weight: bold; }
    </style>
</head>
<body>

<div class="container">
    <div class="admin-btn" onclick="adminLogin()">Teacher Access üîí</div>

    <div id="page-start">
        <img src="character.png" class="owl-img">
        <div class="bubble">Hello, Grade 6 Student! I am your Math Buddy. Are you ready?</div>
        <button class="btn-start" onclick="showRegistration()">START TEST</button>
    </div>

    <div id="page-reg" class="hidden">
        <img src="character.png" style="width: 70px; float: right;">
        <h2 style="color: var(--primary); text-align: left;">Mathematics - Grade 6</h2>
        <p style="text-align: left;">Please enter your details to proceed:</p>
        <input type="text" id="studentName" placeholder="Full Name (Pangalan)" style="width:95%; padding:14px; margin-bottom:10px; border-radius:8px; border:2px solid #ddd; font-size:16px;">
        <input type="text" id="studentSchool" placeholder="School Name (Paaralan)" style="width:95%; padding:14px; margin-bottom:15px; border-radius:8px; border:2px solid #ddd; font-size:16px;">
        <button class="btn-start" onclick="startTest()">PROCEED TO EXAM</button>
    </div>

    <div id="page-quiz" class="hidden">
        <div class="header-info">
            <div id="timer">40:00</div>
            <div style="font-weight:bold; color:var(--primary);">Math Test</div>
            <img src="character.png" style="width: 40px;">
        </div>
        <div id="quiz-content" style="text-align: left;">
            <h3 id="q-title"></h3>
            <div id="q-image-container"></div>
            <div id="options-container"></div>
        </div>
        <div style="display: flex; justify-content: space-between; margin-top: 25px;">
            <button onclick="prevQuestion()" id="btnBack" style="background:#9e9e9e; color:white;">BACK</button>
            <button onclick="nextQuestion()" id="btnNext" class="btn-next">NEXT</button>
        </div>
    </div>

    <div id="page-results" class="hidden">
        <img src="character.png" class="owl-img">
        <h2 id="final-score-text"></h2>
        <div id="review-container" style="max-height: 300px; overflow-y: auto; margin: 20px 0; border: 1px solid #eee; padding: 10px;"></div>
        <button class="btn-start" onclick="location.reload()">FINISH & CLOSE</button>
    </div>

    <div id="page-admin" class="hidden">
        <h2 style="color: var(--secondary);">Teacher Dashboard</h2>
        <button onclick="syncToCloud()" style="background:#2ecc71; color:white; width:100%; padding:15px; margin-bottom:15px; border-radius:10px; border:none; font-weight:bold;">‚òÅÔ∏è Sync to Google Sheets</button>
        <div style="overflow-x:auto;">
            <table id="adminTable" style="width:100%; border-collapse:collapse; font-size:12px;">
                <thead id="adminThead"></thead>
                <tbody id="adminTbody"></tbody>
            </table>
        </div>
        <button onclick="location.reload()" style="margin-top:20px; background:#ddd;">Back to Home</button>
    </div>
</div>

<script>
    // --- ILAGAY ANG IYONG GOOGLE SCRIPT URL DITO ---
    const CLOUD_URL = "https://script.google.com/macros/s/AKfycbz2LX70TXDsjd_r7spB8fGvlMQ8fthtJ3WnUSzvf1IJpJDY0bGyekkJJ1UKJi7fIDsv/exec"; 

    const questions = [
        { q: "How will you describe a rectangular prism?", options: ["It has one face but no edges or vertices.", "It has two circular faces but has no edges or vertices.", "It has three pairs of congruent parallel faces.", "It has one base and at least three triangular faces."], answer: 2, img: "q1.png" },
        { q: "How will you visualize a sphere?", options: ["I and II", "II and III", "III and IV", "I and IV"], answer: 3, img: "q2.png" },
        { q: "How will you differentiate solid figures from plane figures?", options: ["Solid figures have three dimensions while plane figures have two dimensions.", "Plane figures have three dimensions while solid figures have two dimensions.", "Solid figures have dimensions: width, length and height while plane figures have width and length.", "Plane figures have width, length and height while solid figures have width and length."], answer: 2, img: null },
        { q: "You will differentiate solid figures from plane figures by giving examples of each. Which of the following is correct?", options: ["Sphere, Cone, and Pyramid are solid figures while Circle, Triangle and Square are plane figures.", "Circle, Triangle and Square are solid figures while Sphere, Cone, and Pyramid are plane figures.", "Solid figures have only length and width while plane figures have height and depth.", "Plane figures have width, length and height while solid figures have width and length."], answer: 0, img: null },
        { q: "What rule should be formulated to find the next term in the sequence: 86, 81, 76, 71, 66?", options: ["Subtract 5 from the term before it.", "Add 5 from the term before it.", "Subtract 5 from the term after it.", "Add 5 from the term after it."], answer: 0, img: null },
        { q: "Which of the following are the faces of a rectangular prism from the given nets?", options: ["Choice A", "Choice B", "Choice C", "Choice D"], answer: 1, img: "q6.png" },
        { q: "Which of the following is the net of a square pyramid?", options: ["Choice A", "Choice B", "Choice C", "Choice D"], answer: 0, img: "q7.png" },
        { q: "Formulate a rule to find the next term in the sequence: 2, 6, 18, 54, ...", options: ["Divide 3 to the term before it.", "Multiply 3 to the term before it.", "Subtract 3 to the term before it.", "Add 3 to the term before it."], answer: 1, img: null },
        { q: "What rule must be formulated to find the 6th and the succeeding terms of the sequence below?", options: ["Subtract 2 from the product of 5 and n (5n ‚Äì 2).", "Multiply 5 to n (5n).", "Subtract 5 from the product of 2 and n (2n ‚Äì 5).", "Add 2 from the product of 5 and n (5n + 2)."], answer: 0, img: "q9.png" },
        { q: "Study the sequence below. What rule will you formulate to find the 6th term of the sequence?", options: ["3n ‚Äì 8", "3n + 8", "3n + 5", "3n ‚Äì 5"], answer: 1, img: "q10.png" }
    ];

    let currentIdx = 0;
    let studentAnswers = new Array(questions.length).fill(null);
    let timeLeft = 40 * 60;
    let timerInterval;

    function showRegistration() {
        document.getElementById('page-start').classList.add('hidden');
        document.getElementById('page-reg').classList.remove('hidden');
    }

    function startTest() {
        const name = document.getElementById('studentName').value;
        const school = document.getElementById('studentSchool').value;
        if(!name || !school) return alert("Teacher Owl says: Please enter your name and school! ü¶â");
        document.getElementById('page-reg').classList.add('hidden');
        document.getElementById('page-quiz').classList.remove('hidden');
        startTimer();
        renderQuestion();
    }

    function startTimer() {
        timerInterval = setInterval(() => {
            timeLeft--;
            let m = Math.floor(timeLeft/60), s = timeLeft%60;
            document.getElementById('timer').innerText = `${m}:${s<10?'0':''}${s}`;
            if(timeLeft<=0) endTest();
        }, 1000);
    }

    function renderQuestion() {
        const q = questions[currentIdx];
        document.getElementById('q-title').innerText = `${currentIdx + 1}. ${q.q}`;
        document.getElementById('q-image-container').innerHTML = q.img ? `<img src="${q.img}" class="q-img">` : "";
        const optCont = document.getElementById('options-container'); optCont.innerHTML = "";
        q.options.forEach((opt, i) => {
            const div = document.createElement('div');
            div.className = `option ${studentAnswers[currentIdx] === i ? 'selected' : ''}`;
            div.innerText = `${String.fromCharCode(65+i)}. ${opt}`;
            div.onclick = () => { studentAnswers[currentIdx] = i; renderQuestion(); };
            optCont.appendChild(div);
        });
        document.getElementById('btnBack').style.visibility = currentIdx === 0 ? 'hidden' : 'visible';
        document.getElementById('btnNext').innerText = currentIdx === questions.length - 1 ? 'FINISH' : 'NEXT';
    }

    function nextQuestion() {
        if (studentAnswers[currentIdx] === null) return alert("Select an answer first! ü¶â");
        if (currentIdx < questions.length - 1) { currentIdx++; renderQuestion(); }
        else { if(confirm("Submit your test?")) endTest(); }
    }

    function prevQuestion() { if(currentIdx > 0) { currentIdx--; renderQuestion(); } }

    function endTest() {
        clearInterval(timerInterval);
        let score = 0;
        let reviewHtml = "";
        questions.forEach((q, i) => {
            const isCorrect = studentAnswers[i] === q.answer;
            if(isCorrect) score++;
            reviewHtml += `<div class="review-box">
                <b>No. ${i+1}:</b> ${isCorrect ? '<span class="correct">‚úîÔ∏è Tama</span>' : '<span class="wrong">‚ùå Mali</span>'}<br>
                Correct Answer: ${q.options[q.answer]}
            </div>`;
        });

        const name = document.getElementById('studentName').value;
        const school = document.getElementById('studentSchool').value;
        
        // Save to LocalStorage
        let history = JSON.parse(localStorage.getItem('math_quiz_history') || "[]");
        history.push({
            name, school, score, 
            dateTime: new Date().toLocaleString(),
            details: studentAnswers.map((ans, i) => ans === questions[i].answer ? "CHECK" : "EKIS")
        });
        localStorage.setItem('math_quiz_history', JSON.stringify(history));

        document.getElementById('final-score-text').innerText = `You scored ${score} / ${questions.length}`;
        document.getElementById('review-container').innerHTML = reviewHtml;
        document.getElementById('page-quiz').classList.add('hidden');
        document.getElementById('page-results').classList.remove('hidden');
    }

    function adminLogin() {
        if(prompt("Teacher PIN:") === "1234") {
            document.querySelectorAll('.container > div').forEach(d => d.classList.add('hidden'));
            document.getElementById('page-admin').classList.remove('hidden');
            const history = JSON.parse(localStorage.getItem('math_quiz_history') || "[]");
            document.getElementById('adminThead').innerHTML = `<tr><th>Name</th><th>Score</th><th>Date</th></tr>`;
            document.getElementById('adminTbody').innerHTML = history.map(h => `<tr><td>${h.name}</td><td>${h.score}/10</td><td>${h.dateTime}</td></tr>`).join('');
        }
    }

    async function syncToCloud() {
        const history = JSON.parse(localStorage.getItem('math_quiz_history') || "[]");
        if(history.length === 0) return alert("No data to sync.");
        for(let data of history) {
            await fetch(CLOUD_URL, { method: 'POST', mode: 'no-cors', body: JSON.stringify(data) });
        }
        alert("Synced to Google Sheets! ‚òÅÔ∏è");
    }

    if ('serviceWorker' in navigator) {
        window.addEventListener('load', () => { navigator.serviceWorker.register('./sw.js'); });
    }
</script>
</body>
</html>
