<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Grade 6 Math Proficiency Test</title>
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#4db6ac">
    <style>
        :root { --primary: #4db6ac; --secondary: #ff5722; --bg: #f4f7f6; }
        body { font-family: 'Segoe UI', Tahoma, sans-serif; background-color: var(--bg); margin: 0; padding: 10px; }
        .container { max-width: 950px; margin: 0 auto; background: white; padding: 25px; border-radius: 20px; box-shadow: 0 10px 30px rgba(0,0,0,0.1); position: relative; min-height: 500px; }
        .hidden { display: none; }
        
        /* Owl Motivation */
        .owl-motivation { display: flex; align-items: center; gap: 15px; margin-bottom: 5px; justify-content: center; }
        .owl-mini { width: 85px; height: auto; }
        .bubble { background: #fff; border: 3px solid var(--primary); padding: 12px; border-radius: 15px; flex: 1; font-weight: bold; color: #00796b; font-size: 14px; position: relative; text-align: center; }

        /* Car Slider */
        .car-track { width: 100%; height: 8px; background: #e0e0e0; border-radius: 5px; position: relative; margin: 25px 0 20px 0; border: 1px solid #ccc; }
        #car { position: absolute; top: -22px; left: 0; font-size: 22px; transition: 0.5s ease-in-out; }

        .header-info { display: flex; justify-content: space-between; align-items: center; background: #e0f2f1; padding: 10px 15px; border-radius: 10px; border: 2px solid var(--primary); margin-bottom: 15px; }
        #timer { font-size: 22px; font-weight: bold; color: #d32f2f; font-family: monospace; }
        
        .option { display: block; background: #fff; border: 2px solid #b2dfdb; padding: 12px; margin: 8px 0; border-radius: 10px; cursor: pointer; text-align: left; }
        .option.selected { background: var(--primary); color: white; border-color: #00796b; font-weight: bold; }
        
        .q-img { max-width: 100%; height: auto; border-radius: 10px; margin: 10px 0; border: 1px solid #ddd; display: block; margin-left: auto; margin-right: auto; }
        
        button { padding: 15px 30px; border: none; border-radius: 50px; cursor: pointer; font-weight: bold; font-size: 16px; }
        .btn-start { background: var(--secondary); color: white; width: 100%; font-size: 20px; margin-top: 10px; }
        .btn-next { background: var(--primary); color: white; }
        .admin-access { position: absolute; top: 10px; right: 15px; opacity: 0.5; font-size: 12px; cursor: pointer; font-weight: bold; color: #777; }
        
        /* Dashboard & Table */
        .dashboard-container { overflow-x: auto; margin-top: 15px; background: #fff; border-radius: 10px; }
        table { width: 100%; border-collapse: collapse; font-size: 11px; min-width: 900px; }
        th, td { border: 1px solid #ddd; padding: 8px; text-align: center; }
        th { background: var(--primary); color: white; }
        .review-box { border: 1px solid #ddd; padding: 10px; margin: 5px 0; border-radius: 8px; text-align: left; font-size: 14px; }
    </style>
</head>
<body>

<div class="container">
    <div class="admin-access" onclick="adminLogin()">Teacher Access üîí</div>

    <div id="page-start" style="text-align: center;">
        <img src="character.png" style="width: 150px; margin-bottom: 15px;">
        <div class="bubble" style="margin-bottom: 20px;">Hello, Grade 6 Student! I am your Math Buddy. Are you ready?</div>
        <button class="btn-start" onclick="showRegistration()">START TEST</button>
    </div>

    <div id="page-reg" class="hidden">
        <div style="text-align: left; background: #e0f2f1; padding: 15px; border-radius: 10px; border-left: 5px solid var(--primary); margin-bottom: 20px;">
            <img src="character.png" style="width: 60px; float: right;">
            <h2 style="color: var(--primary); margin: 0;">Mathematics - Grade 6</h2>
            <p style="margin: 5px 0; font-weight: bold; color: #555;">Teacher's Assessment Tool</p>
        </div>
        <input type="text" id="studentName" placeholder="Full Name (Pangalan)" style="width:95%; padding:14px; margin-bottom:10px; border-radius:8px; border:2px solid #ddd; font-size:16px;">
        <input type="text" id="studentSchool" placeholder="School Name (Paaralan)" style="width:95%; padding:14px; margin-bottom:15px; border-radius:8px; border:2px solid #ddd; font-size:16px;">
        <button class="btn-start" onclick="startTest()">PROCEED TO EXAM</button>
    </div>

    <div id="page-quiz" class="hidden">
        <div class="header-info"><div id="timer">40:00</div><div style="font-weight: bold; color: var(--primary);">Quiz Mode</div></div>
        <div class="owl-motivation"><img src="character.png" class="owl-mini"><div class="bubble" id="owl-message">Good luck! ü¶â</div></div>
        <div class="car-track"><div id="car">üöó</div></div>
        <div id="quiz-content" style="text-align: left;"><h3 id="q-title"></h3><div id="q-image-container"></div><div id="options-container"></div></div>
        <div style="display: flex; justify-content: space-between; margin-top: 25px;"><button onclick="prevQuestion()" id="btnBack" style="background:#9e9e9e; color:white;">BACK</button><button onclick="nextQuestion()" id="btnNext" class="btn-next">NEXT</button></div>
    </div>

    <div id="page-results" class="hidden" style="text-align: center;">
        <img src="character.png" style="width: 100px;"><h2 id="final-score-text"></h2><div id="review-container" style="max-height: 250px; overflow-y: auto; margin: 20px 0; border: 1px solid #eee; padding: 10px;"></div><button class="btn-start" onclick="location.reload()">FINISH & CLOSE</button>
    </div>

    <div id="page-admin" class="hidden">
        <h2 style="color: var(--secondary); text-align: center;">Teacher Dashboard</h2>
        <div style="display: flex; gap: 10px; margin-bottom: 15px;">
            <button onclick="syncToCloud()" style="background:#2ecc71; color:white; flex: 1;">‚òÅÔ∏è Sync to Google Sheets</button>
            <button onclick="downloadCSV()" style="background:#3498db; color:white; flex: 1;">üì• Download CSV (Excel)</button>
        </div>
        <div class="dashboard-container">
            <table id="adminTable">
                <thead>
                    <tr>
                        <th>Name</th><th>School</th>
                        <th>Q1</th><th>Q2</th><th>Q3</th><th>Q4</th><th>Q5</th>
                        <th>Q6</th><th>Q7</th><th>Q8</th><th>Q9</th><th>Q10</th>
                        <th>Total</th><th>Date</th>
                    </tr>
                </thead>
                <tbody id="adminTbody"></tbody>
            </table>
        </div>
        <button onclick="location.reload()" style="margin-top:20px; background:#ddd; width: 100%;">Back to Start Screen</button>
    </div>
</div>

<script>
    // ILAGAY DITO ANG IYONG GOOGLE SCRIPT URL
    const CLOUD_URL = "https://script.google.com/macros/s/AKfycbz2LX70TXDsjd_r7spB8fGvlMQ8fthtJ3WnUSzvf1IJpJDY0bGyekkJJ1UKJi7fIDsv/exec"; 

    const owlMessages = ["Let's start! ü¶â", "Keep going! ‚ú®", "Think carefully! üß†", "Halfway there! üí™", "Amazing! üåü", "Just a few more! üöÄ", "You're a wizard! üßô‚Äç‚ôÇÔ∏è", "Focus! üéØ", "Almost done! üèÜ", "Last one! üéâ"];
    const questions = [
        { q: "How will you describe a rectangular prism?", options: ["It has one face but no edges or vertices.", "It has two circular faces but has no edges or vertices.", "It has three pairs of congruent parallel faces.", "It has one base and at least three triangular faces."], answer: 2, img: "q1.png" },
        { q: "How will you visualize a sphere?", options: ["I and II", "II and III", "III and IV", "I and IV"], answer: 3, img: "q2.png" },
        { q: "How will you differentiate solid figures from plane figures?", options: ["Solid figures have 3D while plane figures have 2D.", "Plane figures have 3D while solid figures have 2D.", "Solid figures have dimensions: width, length and height while plane figures only have length and width.", "Plane figures have dimensions: width, length and height while solid figures only have length and width."], answer: 2, img: null },
        { q: "You will differentiate solid figures from plane figures by giving examples of each. Which is correct?", options: ["Sphere, Cone are solid; Circle, Square are plane.", "Circle, Square are solid; Sphere, Cone are plane.", "Solid figures only have length and width.", "Plane figures have width, length and height."], answer: 0, img: null },
        { q: "What rule should be formulated to find the next term: 86, 81, 76, 71, 66?", options: ["Subtract 5 from the term before it.", "Add 5 from the term before it.", "Subtract 5 from the term after it.", "Add 5 from the term after it."], answer: 0, img: null },
        { q: "Which of the following are the faces of a rectangular prism from the given nets?", options: ["Choice A", "Choice B", "Choice C", "Choice D"], answer: 1, img: "q6.png" },
        { q: "Which of the following is the net of a square pyramid?", options: ["Choice A", "Choice B", "Choice C", "Choice D"], answer: 0, img: "q7.png" },
        { q: "Formulate a rule to find the next term in the sequence: 2, 6, 18, 54, ...", options: ["Divide 3 to the term before it.", "Multiply 3 to the term before it.", "Subtract 3 to the term before it.", "Add 3 to the term before it."], answer: 1, img: null },
        { q: "What rule must be formulated to find the 6th and succeeding terms of the sequence (3, 8, 13, 18, 23)?", options: ["5n ‚Äì 2", "5n", "2n ‚Äì 5", "5n + 2"], answer: 0, img: "q9.png" },
        { q: "Study the sequence below (11, 14, 17, 20, 23). What rule will you formulate to find the 6th term?", options: ["3n ‚Äì 8", "3n + 8", "3n + 5", "3n ‚Äì 5"], answer: 1, img: "q10.png" }
    ];

    let currentIdx = 0, studentAnswers = new Array(questions.length).fill(null), timeLeft = 40 * 60, timerInterval;

    function showRegistration() { document.getElementById('page-start').classList.add('hidden'); document.getElementById('page-reg').classList.remove('hidden'); }
    function startTest() { if(!document.getElementById('studentName').value || !document.getElementById('studentSchool').value) return alert("Please enter details! ü¶â"); document.getElementById('page-reg').classList.add('hidden'); document.getElementById('page-quiz').classList.remove('hidden'); startTimer(); renderQuestion(); }
    function startTimer() { timerInterval = setInterval(() => { timeLeft--; let m = Math.floor(timeLeft/60), s = timeLeft%60; document.getElementById('timer').innerText = `${m}:${s<10?'0':''}${s}`; if(timeLeft<=0) endTest(); }, 1000); }
    function renderQuestion() { const q = questions[currentIdx]; document.getElementById('q-title').innerText = `${currentIdx + 1}. ${q.q}`; document.getElementById('owl-message').innerText = owlMessages[currentIdx]; document.getElementById('q-image-container').innerHTML = q.img ? `<img src="${q.img}" class="q-img">` : ""; const optCont = document.getElementById('options-container'); optCont.innerHTML = ""; q.options.forEach((opt, i) => { const div = document.createElement('div'); div.className = `option ${studentAnswers[currentIdx] === i ? 'selected' : ''}`; div.innerText = `${String.fromCharCode(65+i)}. ${opt}`; div.onclick = () => { studentAnswers[currentIdx] = i; renderQuestion(); }; optCont.appendChild(div); }); document.getElementById('car').style.left = `${(currentIdx / (questions.length - 1)) * 95}%`; document.getElementById('btnBack').style.visibility = currentIdx === 0 ? 'hidden' : 'visible'; document.getElementById('btnNext').innerText = currentIdx === questions.length - 1 ? 'FINISH' : 'NEXT'; }
    function nextQuestion() { if (studentAnswers[currentIdx] === null) return alert("Select an answer! ü¶â"); if (currentIdx < questions.length - 1) { currentIdx++; renderQuestion(); } else { if(confirm("Submit?")) endTest(); } }
    function prevQuestion() { if(currentIdx > 0) { currentIdx--; renderQuestion(); } }

    function endTest() {
        clearInterval(timerInterval);
        let score = 0, reviewHtml = "";
        const detailedAnswers = studentAnswers.map((ans, i) => ans === questions[i].answer ? "‚úîÔ∏è" : "‚ùå");
        detailedAnswers.forEach((sym, i) => { if(sym === "‚úîÔ∏è") score++; reviewHtml += `<div class="review-box"><b>No. ${i+1}:</b> ${sym === "‚úîÔ∏è" ? '‚úîÔ∏è Tama' : '‚ùå Mali'}<br>Ans: ${questions[i].options[questions[i].answer]}</div>`; });
        
        let history = JSON.parse(localStorage.getItem('math_quiz_history') || "[]");
        history.push({ name: document.getElementById('studentName').value, school: document.getElementById('studentSchool').value, score: `${score}/10`, dateTime: new Date().toLocaleString(), details: detailedAnswers });
        localStorage.setItem('math_quiz_history', JSON.stringify(history));
        document.getElementById('final-score-text').innerText = `You scored ${score} / 10`;
        document.getElementById('review-container').innerHTML = reviewHtml;
        document.getElementById('page-quiz').classList.add('hidden'); document.getElementById('page-results').classList.remove('hidden');
    }

    function adminLogin() {
        if(prompt("Teacher PIN:") === "1234") {
            document.querySelectorAll('.container > div').forEach(d => d.classList.add('hidden')); document.getElementById('page-admin').classList.remove('hidden');
            const history = JSON.parse(localStorage.getItem('math_quiz_history') || "[]");
            document.getElementById('adminTbody').innerHTML = history.map(h => `
                <tr>
                    <td>${h.name}</td><td>${h.school}</td>
                    ${h.details.map(d => `<td>${d}</td>`).join('')}
                    <td style="font-weight:bold;">${h.score}</td><td>${h.dateTime}</td>
                </tr>`).join('');
        }
    }

    function downloadCSV() {
        const history = JSON.parse(localStorage.getItem('math_quiz_history') || "[]");
        if(history.length === 0) return alert("Walang data para i-download.");
        let csv = "Name,School,Q1,Q2,Q3,Q4,Q5,Q6,Q7,Q8,Q9,Q10,Score,Date\n";
        history.forEach(h => { csv += `"${h.name}","${h.school}",${h.details.join(',')},"${h.score}","${h.dateTime}"\n`; });
        const blob = new Blob(["\ufeff" + csv], { type: 'text/csv;charset=utf-8;' });
        const url = window.URL.createObjectURL(blob);
        const a = document.createElement('a'); a.setAttribute('hidden', ''); a.setAttribute('href', url); a.setAttribute('download', 'Grade6_Math_Results.csv');
        document.body.appendChild(a); a.click(); document.body.removeChild(a);
    }

    async function syncToCloud() {
        const history = JSON.parse(localStorage.getItem('math_quiz_history') || "[]");
        if(history.length === 0) return alert("No data.");
        for(let d of history) { await fetch(CLOUD_URL, { method: 'POST', mode: 'no-cors', body: JSON.stringify(d) }); }
        alert("Synced! ‚òÅÔ∏è");
    }

    if ('serviceWorker' in navigator) { window.addEventListener('load', () => { navigator.serviceWorker.register('./sw.js'); }); }
</script>
</body>
</html>
