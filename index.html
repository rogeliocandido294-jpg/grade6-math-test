<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Grade 6 Math Test</title>
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#4db6ac">
    <style>
        :root { --primary: #4db6ac; --secondary: #ff5722; --bg: #f4f7f6; }
        body { font-family: 'Segoe UI', sans-serif; background: var(--bg); margin: 0; padding: 10px; }
        .container { max-width: 800px; margin: 0 auto; background: white; padding: 25px; border-radius: 20px; box-shadow: 0 10px 30px rgba(0,0,0,0.1); position: relative; min-height: 400px; }
        .hidden { display: none; }
        .owl-img { width: 120px; height: auto; display: block; margin: 0 auto 15px; }
        .bubble { background: #fff; border: 3px solid var(--primary); padding: 15px; border-radius: 15px; text-align: center; font-weight: bold; color: #00796b; margin-bottom: 20px; }
        .header-info { display: flex; justify-content: space-between; align-items: center; background: #e0f2f1; padding: 15px; border-radius: 10px; border: 2px solid var(--primary); margin-bottom: 20px; }
        #timer { font-size: 24px; font-weight: bold; color: #d32f2f; }
        .option { display: block; background: #fff; border: 2px solid #b2dfdb; padding: 12px; margin: 8px 0; border-radius: 10px; cursor: pointer; transition: 0.3s; }
        .option.selected { background: var(--primary); color: white; }
        .q-img { max-width: 100%; height: auto; border-radius: 10px; margin: 10px 0; }
        button { padding: 15px 30px; border: none; border-radius: 50px; cursor: pointer; font-weight: bold; font-size: 16px; transition: 0.3s; }
        .btn-start { background: var(--secondary); color: white; width: 100%; }
        .btn-next { background: var(--primary); color: white; }
        .review-box { border: 1px solid #ddd; padding: 10px; margin: 5px 0; border-radius: 8px; text-align: left; }
        .correct { color: green; font-weight: bold; }
        .wrong { color: red; font-weight: bold; }
    </style>
</head>
<body>

<div class="container">
    <div id="page-start">
        <img src="character.png" class="owl-img">
        <div class="bubble">Welcome! I am Teacher Owl. Let's test your Math skills!</div>
        <button class="btn-start" onclick="showPage('page-reg')">START</button>
    </div>

    <div id="page-reg" class="hidden">
        <img src="character.png" style="width: 60px; float: right;">
        <h2 style="color: var(--primary);">Mathematics - Grade 6</h2>
        <p>Please enter your details to proceed:</p>
        <input type="text" id="studentName" placeholder="Full Name" style="width:90%; padding:12px; margin-bottom:10px; border-radius:8px; border:2px solid #ddd;">
        <input type="text" id="studentSchool" placeholder="School Name" style="width:90%; padding:12px; margin-bottom:10px; border-radius:8px; border:2px solid #ddd;">
        <button class="btn-start" onclick="startTest()">PROCEED TO EXAM</button>
    </div>

    <div id="page-quiz" class="hidden">
        <div class="header-info">
            <div id="timer">40:00</div>
            <img src="character.png" style="width: 40px;">
        </div>
        <div id="quiz-content">
            <h3 id="q-title"></h3>
            <div id="q-image-container"></div>
            <div id="options-container"></div>
        </div>
        <div style="display: flex; justify-content: space-between; margin-top: 20px;">
            <button onclick="prevQuestion()" id="btnBack" style="background:#9e9e9e; color:white;">BACK</button>
            <button onclick="nextQuestion()" id="btnNext" class="btn-next">NEXT</button>
        </div>
    </div>

    <div id="page-results" class="hidden">
        <img src="character.png" class="owl-img">
        <h2 id="final-score-text"></h2>
        <div id="review-container" style="max-height: 300px; overflow-y: auto; margin-bottom: 20px;"></div>
        <button class="btn-start" onclick="location.reload()">FINISH</button>
    </div>
</div>

<script>
    const CLOUD_URL = "lala: Huwag kalimutang palitan ang PALITAN_NG_IYONG_SCRIPT_URL sa loob ng code gamit ang link mula sa iyong Google Sheet para gumana ang sync.

Subukan mo itong i-refresh at i-save uli. Kapag nag-save na, sabihin mo sa akin para ma-test ko ang iyong link!";
    const questions = [
        { q: "How will you describe a rectangular prism?", options: ["It has one face but no edges or vertices.", "It has two circular faces but has no edges or vertices.", "It has three pairs of congruent parallel faces.", "It has one base and at least three triangular faces."], answer: 2, img: "q1.png" },
        { q: "How will you visualize a sphere?", options: ["I and II", "II and III", "III and IV", "I and IV"], answer: 3, img: "q2.png" },
        { q: "How will you differentiate solid figures from plane figures?", options: ["Solid figures have three dimensions while plane figures have two dimensions.", "Plane figures have three dimensions while solid figures have two dimensions.", "Solid figures have dimensions: width, length and height while plane figures have width and length.", "Plane figures have width, length and height while solid figures have width and length."], answer: 2, img: null },
        { q: "What rule should be formulated to find the next term in the sequence: 86, 81, 76, 71, 66?", options: ["Subtract 5", "Add 5", "Multiply 5", "Divide 5"], answer: 0, img: null },
        { q: "Which of the following are the faces of a rectangular prism?", options: ["Net A", "Net B", "Net C", "Net D"], answer: 1, img: "q6.png" },
        { q: "Which is the net of a square pyramid?", options: ["Net A", "Net B", "Net C", "Net D"], answer: 0, img: "q7.png" },
        { q: "Rule for sequence: 2, 6, 18, 54, ...", options: ["Divide by 3", "Multiply by 3", "Subtract 3", "Add 3"], answer: 1, img: null },
        { q: "Rule for sequence: 3, 8, 13, 18, 23...", options: ["5n - 2", "5n", "2n - 5", "5n + 2"], answer: 0, img: "q9.png" },
        { q: "Rule for sequence: 11, 14, 17, 20, 23...", options: ["3n - 8", "3n + 8", "3n + 5", "3n - 5"], answer: 1, img: "q10.png" }
    ];

    let currentIdx = 0, studentAnswers = new Array(questions.length).fill(null), timeLeft = 40 * 60, timerInterval;

    function showPage(id) {
        document.querySelectorAll('.container > div').forEach(d => d.classList.add('hidden'));
        document.getElementById(id).classList.remove('hidden');
    }

    function startTest() {
        if(!document.getElementById('studentName').value) return alert("Please enter your name!");
        showPage('page-quiz');
        startTimer();
        renderQuestion();
    }

    function startTimer() {
        timerInterval = setInterval(() => {
            timeLeft--;
            let mins = Math.floor(timeLeft/60), secs = timeLeft%60;
            document.getElementById('timer').innerText = `${mins}:${secs<10?'0':''}${secs}`;
            if(timeLeft<=0) endTest();
        }, 1000);
    }

    function renderQuestion() {
        const q = questions[currentIdx];
        document.getElementById('q-title').innerText = `${currentIdx + 1}. ${q.q}`;
        document.getElementById('q-image-container').innerHTML = q.img ? `<img src="${q.img}" class="q-img">` : "";
        const optCont = document.getElementById('options-container'); optCont.innerHTML = "";
        q.options.forEach((opt, i) => {
            const div = document.createElement('div');
            div.className = `option ${studentAnswers[currentIdx] === i ? 'selected' : ''}`;
            div.innerText = `${String.fromCharCode(65+i)}. ${opt}`;
            div.onclick = () => { studentAnswers[currentIdx] = i; renderQuestion(); };
            optCont.appendChild(div);
        });
        document.getElementById('btnBack').style.visibility = currentIdx === 0 ? 'hidden' : 'visible';
        document.getElementById('btnNext').innerText = currentIdx === questions.length - 1 ? 'FINISH' : 'NEXT';
    }

    function nextQuestion() {
        if (studentAnswers[currentIdx] === null) return alert("Teacher Owl says: Please select an answer first! ü¶â");
        if (currentIdx < questions.length - 1) { currentIdx++; renderQuestion(); } 
        else { if(confirm("Are you sure you want to submit?")) endTest(); }
    }

    function prevQuestion() { if(currentIdx > 0) { currentIdx--; renderQuestion(); } }

    function endTest() {
        clearInterval(timerInterval);
        let score = 0;
        let reviewHtml = "";
        questions.forEach((q, i) => {
            const isCorrect = studentAnswers[i] === q.answer;
            if(isCorrect) score++;
            reviewHtml += `<div class="review-box">
                <b>No. ${i+1}:</b> ${isCorrect ? '<span class="correct">‚úîÔ∏è Tama</span>' : '<span class="wrong">‚ùå Mali</span>'}<br>
                Correct Answer: ${q.options[q.answer]}
            </div>`;
        });

        document.getElementById('final-score-text').innerText = `You scored ${score} / ${questions.length}`;
        document.getElementById('review-container').innerHTML = reviewHtml;
        
        // Save Local
        const history = JSON.parse(localStorage.getItem('math_quiz_history') || "[]");
        history.push({ 
            name: document.getElementById('studentName').value, 
            school: document.getElementById('studentSchool').value,
            dateTime: new Date().toLocaleString(),
            score: score,
            details: studentAnswers.map((ans, i) => ans === questions[i].answer ? "CHECK" : "EKIS")
        });
        localStorage.setItem('math_quiz_history', JSON.stringify(history));
        
        showPage('page-results');
    }

    if ('serviceWorker' in navigator) {
        window.addEventListener('load', () => { navigator.serviceWorker.register('./sw.js'); });
    }
</script>
</body>
</html>

