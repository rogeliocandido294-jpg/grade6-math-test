<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Grade 6 Math Proficiency Test</title>
    <style>
        :root { --primary: #4db6ac; --secondary: #ff5722; --bg: #f4f7f6; }
        body { font-family: 'Segoe UI', Tahoma, sans-serif; background-color: var(--bg); margin: 0; padding: 10px; }
        .container { max-width: 850px; margin: 0 auto; background: white; padding: 25px; border-radius: 20px; box-shadow: 0 10px 30px rgba(0,0,0,0.1); position: relative; min-height: 500px; }
        .hidden { display: none; }
        
        /* Teacher Access */
        .admin-access { position: absolute; top: 10px; right: 10px; opacity: 0.3; cursor: pointer; font-size: 12px; font-weight: bold; }
        .admin-access:hover { opacity: 1; color: var(--secondary); }

        /* Owl & Bubble */
        .owl-box { display: flex; align-items: center; gap: 15px; margin-bottom: 20px; justify-content: center; }
        .owl-img { width: 100px; height: auto; }
        .bubble { background: #fff; border: 3px solid var(--primary); padding: 15px; border-radius: 15px; position: relative; flex: 1; font-weight: bold; color: #00796b; }

        /* Registration */
        .form-group { text-align: left; margin-bottom: 12px; }
        label { font-weight: bold; display: block; margin-bottom: 5px; }
        input { width: 100%; padding: 12px; border: 2px solid #ddd; border-radius: 8px; box-sizing: border-box; font-size: 16px; }
        
        /* Timer & Car Track */
        .header-info { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; background: #e0f2f1; padding: 15px; border-radius: 10px; border: 2px solid var(--primary); }
        #timer { font-size: 26px; font-weight: bold; color: #d32f2f; font-family: monospace; }
        .track-container { flex-grow: 1; margin-left: 20px; position: relative; }
        .car-track { width: 100%; height: 8px; background: #ccc; border-radius: 5px; position: relative; }
        #car { position: absolute; top: -25px; left: 0; font-size: 25px; transition: 0.5s; }

        /* Quiz area */
        .option { display: block; background: #fff; border: 2px solid #b2dfdb; padding: 14px; margin: 8px 0; border-radius: 10px; cursor: pointer; text-align: left; font-size: 15px; transition: 0.2s; }
        .option:hover { background: #e0f2f1; }
        .option.selected { background: var(--primary); color: white; border-color: #00796b; font-weight: bold; }
        .q-img { max-width: 100%; height: auto; margin: 10px 0; border-radius: 10px; }

        /* Navigation */
        .nav-btns { display: flex; justify-content: space-between; margin-top: 25px; }
        button { padding: 14px 30px; border: none; border-radius: 50px; cursor: pointer; font-weight: bold; font-size: 16px; transition: 0.2s; }
        .btn-next { background: var(--primary); color: white; }
        .btn-back { background: #9e9e9e; color: white; }
        .btn-start { background: var(--secondary); color: white; width: 100%; font-size: 20px; }
        .btn-sync { background: #2ecc71; color: white; margin-bottom: 10px; width: 100%; }
        button:hover { opacity: 0.9; transform: scale(1.02); }

        /* Dashboard table */
        .dashboard-container { overflow-x: auto; margin-top: 15px; }
        table { width: 100%; border-collapse: collapse; min-width: 900px; font-size: 11px; }
        th, td { border: 1px solid #ddd; padding: 8px; text-align: center; }
        th { background: var(--primary); color: white; }
    </style>
</head>
<body>

<div class="container">
    <div class="admin-access" onclick="adminLogin()">Teacher Access üîí</div>

    <div id="page-start">
        <div class="owl-box">
            <img src="character.png" class="owl-img" alt="Owl">
            <div class="bubble">Hello, Grade 6 Student! I am your Math Buddy. Are you ready to take the test? Click the button below!</div>
        </div>
        <button class="btn-start" onclick="showRegistration()">START TEST</button>
    </div>

    <div id="page-reg" class="hidden">
        <h2 style="color: var(--primary);">Student Information</h2>
        <div class="form-group"><label>Name:</label><input type="text" id="studentName" placeholder="Full Name"></div>
        <div class="form-group"><label>School:</label><input type="text" id="studentSchool" placeholder="Your School"></div>
        <div class="form-group"><label>Grade:</label><input type="text" value="Grade 6" readonly></div>
        <div class="form-group"><label>Subject:</label><input type="text" value="Mathematics" readonly></div>
        <div class="owl-box">
            <img src="character.png" class="owl-img">
            <div class="bubble"><strong>INSTRUCTIONS:</strong> Choose or write the correct answer in each item or number. You have only 40 minutes to complete the test.</div>
        </div>
        <button class="btn-start" onclick="startTest()">PROCEED TO EXAM</button>
    </div>

    <div id="page-quiz" class="hidden">
        <div class="header-info">
            <div id="timer">40:00</div>
            <div class="track-container"><div class="car-track"><div id="car">üöó</div></div></div>
        </div>
        <div class="owl-box">
            <img src="character.png" class="owl-img">
            <div class="bubble" id="owl-comment">Analyze the question carefully!</div>
        </div>
        <div id="quiz-content">
            <h3 id="q-title" style="text-align: left;"></h3>
            <div id="q-image-container"></div>
            <div id="options-container"></div>
        </div>
        <div class="nav-btns">
            <button class="btn-back" id="btnBack" onclick="prevQuestion()">BACK</button>
            <button class="btn-next" id="btnNext" onclick="nextQuestion()">NEXT</button>
        </div>
    </div>

    <div id="page-admin" class="hidden">
        <h2 style="color: var(--secondary);">Teacher Dashboard</h2>
        <button class="btn-sync" onclick="syncToCloud()">‚òÅÔ∏è Sync to Google Sheets</button>
        <div class="dashboard-container">
            <table id="resultsTable">
                <thead><tr id="tableHeader"></tr></thead>
                <tbody id="tableBody"></tbody>
            </table>
        </div>
        <br>
        <button class="btn-back" onclick="location.reload()">Exit Dashboard</button>
        <button style="background:#e74c3c; color:white; margin-left:10px" onclick="clearData()">Clear All Records</button>
    </div>
</div>

<script>
    const CLOUD_URL = "https://script.google.com/macros/s/AKfycbz2LX70TXDsjd_r7spB8fGvlMQ8fthtJ3WnUSzvf1IJpJDY0bGyekkJJ1UKJi7fIDsv/exec";
    
    const questions = [
        { q: "How will you describe a rectangular prism?", options: ["It has one face but no edges or vertices.", "It has two circular faces but has no edges or vertices.", "It has three pairs of congruent parallel faces.", "It has one base and at least three triangular faces."], answer: 2, img: "q1.png" },
        { q: "How will you visualize a sphere?", options: ["I and II", "II and III", "III and IV", "I and IV"], answer: 3, img: "q2.png" },
        { q: "How will you differentiate solid figures from plane figures?", options: [
            "Solid figures have three dimensions while plane figures have two dimensions.",
            "Plane figures have three dimensions while solid figures have two dimensions.",
            "Solid figures have three dimensions, the width, length and height or depth while plane figures have two dimensions, the width, and the length.",
            "Plane figures have three dimensions, the width, length and height or depth while solid figures have two dimensions, the width, and the length."
        ], answer: 2, img: null },
        { q: "You will differentiate solid figures from plane figures by giving examples of each. Which of the following is correct?", options: [
            "Sphere, Cone, and Pyramid are solid figures while Circle, Triangle and Square are plane figures.",
            "Circle, Triangle and Square are solid figures while Sphere, Cone, and Pyramid are plane figures.",
            "Solid figures have only length and width while plane figures have height and depth.",
            "Plane figures have width, length and height while solid figures have width and length."
        ], answer: 0, img: null },
        { q: "What rule should be formulated to find the next term in the sequence: 86, 81, 76, 71, 66?", options: ["Subtract 5 from the term before it.", "Add 5 from the term before it.", "Subtract 5 from the term after it.", "Add 5 from the term after it."], answer: 0, img: null },
        { q: "Which of the following are the faces of a rectangular prism from the given nets?", options: ["Choice A", "Choice B", "Choice C", "Choice D"], answer: 1, img: "q6.png" },
        { q: "Which of the following is the net of a square pyramid?", options: ["Choice A", "Choice B", "Choice C", "Choice D"], answer: 0, img: "q7.png" },
        { q: "Formulate a rule to find the next term in the sequence: 2, 6, 18, 54, ...", options: ["Divide 3 to the term before it.", "Multiply 3 to the term before it.", "Subtract 3 to the term before it.", "Add 3 to the term before it."], answer: 1, img: null },
        { q: "What rule must be formulated to find the 6th and the succeeding terms of the sequence below?", options: [
            "Subtract 2 from the product of 5 and the sequence number ( n ) to find the value of the 6th and the succeeding terms (5n ‚Äì 2).",
            "Multiply 5 to the sequence number ( n ) to find the value of the 6th and the succeeding terms (5n).",
            "Subtract 5 from the product of 2 and the sequence number ( n ) to find the value of the 6th and the succeeding terms (2n ‚Äì 5).",
            "Add 2 from the product of 5 and the sequence number ( n ) to find the value of the 6th and the succeeding terms (5n + 2)."
        ], answer: 0, img: "q9.png" },
        { q: "Study the sequence below. What rule will you formulate to find the 6th term of the sequence?", options: [
            "Subtract 8 from the product of 3 and the sequence number ( n ) to find the value of the 6th term (3n ‚Äì 8).",
            "Add 8 to the product of 3 and the sequence number ( n ) to find the value of the 6th term (3n + 8).",
            "Add 5 to the product of 3 and the sequence number ( n ) to find the value of the 6th term (3n + 5).",
            "Subtract 5 from the product of 3 and the sequence number ( n ) to find the value of the 6th term (3n ‚Äì 5)."
        ], answer: 1, img: "q10.png" }
    ];

    let currentIdx = 0;
    let studentAnswers = new Array(questions.length).fill(null);
    let timeLeft = 40 * 60;
    let timerInterval;

    function adminLogin() {
        let pin = prompt("Teacher PIN:");
        if (pin === "1234") {
            document.querySelectorAll('.container > div').forEach(d => d.classList.add('hidden'));
            document.getElementById('page-admin').classList.remove('hidden');
            buildDashboard();
        }
    }

    function showRegistration() {
        document.getElementById('page-start').classList.add('hidden');
        document.getElementById('page-reg').classList.remove('hidden');
    }

    function startTest() {
        if(!document.getElementById('studentName').value.trim()) return alert("Enter Name!");
        document.getElementById('page-reg').classList.add('hidden');
        document.getElementById('page-quiz').classList.remove('hidden');
        startTimer();
        renderQuestion();
    }

    function startTimer() {
        timerInterval = setInterval(() => {
            timeLeft--;
            let mins = Math.floor(timeLeft / 60); let secs = timeLeft % 60;
            document.getElementById('timer').innerText = `${mins}:${secs < 10 ? '0' : ''}${secs}`;
            if(timeLeft <= 0) { clearInterval(timerInterval); alert("Time is up!"); endTest(); }
        }, 1000);
    }

    function renderQuestion() {
        const q = questions[currentIdx];
        document.getElementById('q-title').innerText = `${currentIdx + 1}. ${q.q}`;
        document.getElementById('q-image-container').innerHTML = q.img ? `<img src="${q.img}" class="q-img">` : "";
        const optCont = document.getElementById('options-container');
        optCont.innerHTML = "";
        q.options.forEach((opt, i) => {
            const div = document.createElement('div');
            div.className = `option ${studentAnswers[currentIdx] === i ? 'selected' : ''}`;
            div.innerText = `${String.fromCharCode(65+i)}. ${opt}`;
            div.onclick = () => { studentAnswers[currentIdx] = i; renderQuestion(); };
            optCont.appendChild(div);
        });
        document.getElementById('car').style.left = `${(currentIdx / (questions.length - 1)) * 95}%`;
        document.getElementById('btnBack').style.visibility = currentIdx === 0 ? 'hidden' : 'visible';
        document.getElementById('btnNext').innerText = currentIdx === questions.length - 1 ? 'SUBMIT' : 'NEXT';
    }

    function nextQuestion() {
        if (studentAnswers[currentIdx] === null) { if (!confirm("No answer selected. Proceed?")) return; }
        if (currentIdx < questions.length - 1) { currentIdx++; renderQuestion(); } 
        else { if (confirm("Sure to submit? Cannot go back.")) endTest(); }
    }

    function prevQuestion() { if (currentIdx > 0) { currentIdx--; renderQuestion(); } }

    function endTest() {
        clearInterval(timerInterval);
        saveLocal();
        alert("Exam Submitted! Teacher will access your score.");
        location.reload();
    }

    function saveLocal() {
        const name = document.getElementById('studentName').value;
        const school = document.getElementById('studentSchool').value;
        const dateTime = new Date().toLocaleString();
        let score = 0;
        let details = questions.map((q, i) => {
            const ok = studentAnswers[i] === q.answer;
            if(ok) score++;
            return ok ? "CHECK" : "EKIS";
        });
        const data = { name, school, dateTime, score, details };
        let history = JSON.parse(localStorage.getItem('math_quiz_history') || "[]");
        history.push(data);
        localStorage.setItem('math_quiz_history', JSON.stringify(history));
    }

    function buildDashboard() {
        const history = JSON.parse(localStorage.getItem('math_quiz_history') || "[]");
        const header = document.getElementById('tableHeader');
        header.innerHTML = `<th>Date/Time</th><th>Name</th><th>School</th>` + questions.map((_, i) => `<th>Q${i+1}</th>`).join('') + `<th>Score</th>`;
        document.getElementById('tableBody').innerHTML = history.map(d => `
            <tr><td>${d.dateTime}</td><td>${d.name}</td><td>${d.school}</td>
            ${d.details.map(det => `<td>${det === 'CHECK' ? '‚úîÔ∏è' : '‚ùå'}</td>`).join('')}
            <td>${d.score}/10</td></tr>
        `).join('');
    }

    async function syncToCloud() {
        const history = JSON.parse(localStorage.getItem('math_quiz_history') || "[]");
        if(history.length === 0) return alert("No data.");
        alert("Syncing... Please wait.");
        for(let d of history) {
            await fetch(CLOUD_URL, { method: 'POST', mode: 'no-cors', body: JSON.stringify(d) });
        }
        alert("Success! Check your Google Sheet.");
    }

    function clearData() { if(confirm("Delete all?")) { localStorage.removeItem('math_quiz_history'); buildDashboard(); } }
</script>
</body>
</html>